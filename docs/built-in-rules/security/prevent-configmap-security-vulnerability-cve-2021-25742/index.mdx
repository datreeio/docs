---
title: ‚òëÔ∏è Prevent ConfigMap security vulnerability (CVE-2021-25742)
slug: /built-in-rules/prevent-configmap-security-vulnerability-cve-2021-25742
---

A vulnerability has been discovered in Kuberenetes where users with limited access to a Kubernetes cluster, but with the ability to create an Ingress object based on the NGINX Ingress Controller, could elevate privilege and access full cluster secrets ([NVD](https://nvd.nist.gov/vuln/detail/CVE-2021-25742) severity of this issue: **High**).

More specifically, a user who can create or update ingress objects can use the custom snippets feature to obtain all secrets in the cluster. The `allow-snippet-annotations` configuration is set to `true` by default.

**Targeted resources by this rule (types of **`kind`**): **ConfigMap

**Enabled by default?** False

**Policy as code identifier:** CONFIGMAP_CVE2021_25742_INCORRECT_SNIPPET_ANNOTATIONS_VALUE

---

## This rule will fail

If the¬†`allow-snippet-annotations` configuration is not set, or set explicitly to 'true'.

```yaml
kind: ConfigMap
data:
  proxy-connect-timeout: "10"
```

### Rule output in the CLI

```terminal
$ datree test *.yaml

>> File: failExample.yaml
‚ùå Prevent ConfigMap security vulnerability (CVE-2021-25742) [1 occurrence]
üí° Missing property object `allow-snippet-annotations` - set it to 'false' to override default behaviour
```

---

## How to fix this failure

```yaml
kind: ConfigMap
data:
  allow-snippet-annotations: "false"
```

---

## Read more[](https://www.datree.io/resources/kubernetes-configuration-mistakes#anchor3)

- [CVE-2021-25742: Ingress-nginx custom snippets allows retrieval of ingress-nginx serviceaccount token and secrets across all namespaces](https://github.com/kubernetes/ingress-nginx/issues/7837)

- [ConfigMap - NGINX Ingress Controller](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#allow-snippet-annotations)
