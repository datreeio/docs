---
title: ‚òëÔ∏è Prevent Ingress security vulnerability (CVE-2021-25742)
slug: /built-in-rules/prevent-ingress-security-vulnerability-cve-2021-25742
---

A vulnerability has been discovered in Kuberenetes where users with limited access to a Kubernetes cluster, but with the ability to create an Ingress object based on the NGINX Ingress Controller, could elevate privilege and access full cluster secrets ([NVD](https://nvd.nist.gov/vuln/detail/CVE-2021-25742) severity of this issue: **High**).

More specifically, within a server-snippet annotation, one can run ‚ÄúLua‚Äù script code, which is capable of executing incredibly dangerous system-level commands.

**Targeted objects by this rule (types of **`kind`**):** Ingress

**Enabled by default?** False

**Policy as code identifier:** INGRESS_CVE2021_25742_INCORRECT_SERVER_SNIPPET_KEY

---

## This rule will fail

If the¬†`server-snippet` annotation is used.

```yaml
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    nginx.ingress.kubernetes.io/server-snippet: |
      proxy_ssl_verify off;
```

### Rule output in the CLI

```terminal
$ datree test *.yaml

>> File: failExample.yaml
‚ùå Prevent Ingress security vulnerability (CVE-2021-25742) [1 occurrence]
üí° Forbidden property object `server-snippet` - ingress-nginx custom snippets are not allowed
```

---

## How to fix this failure

Refrain from using this vulnerable annotation.

```yaml
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
```

---

## Read more[](https://www.datree.io/resources/kubernetes-configuration-mistakes#anchor3)

- [CVE-2021-25742: Ingress-nginx custom snippets allows retrieval of ingress-nginx serviceaccount token and secrets across all namespaces](https://github.com/kubernetes/ingress-nginx/issues/7837)

- [ConfigMap - NGINX Ingress Controller](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#allow-snippet-annotations)
